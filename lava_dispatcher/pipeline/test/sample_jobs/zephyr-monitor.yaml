# Zephyr JOB definition for QEMU
device_type: arduino101
job_name: zephyr-monitor

timeouts:
  job:
    minutes: 6
  action:
    minutes: 5
  actions:
    lava-test-monitor:
      seconds: 300
    wait-usb-device:
      seconds: 20
    flash-dfu:
      seconds: 60
  connections:
    lava-test-monitor:
      seconds: 300

priority: medium
visibility: public

actions:
- deploy:
    timeout:
      minutes: 3
    to: tmpfs
    images:
        app:
          image_arg: --alt x86_app --download {app}
          url: http://images.validation.linaro.org/functional-test-images/zephyr/arduino_101/app_kernel-zephyr.bin
        sensor_core:
          image_arg: --alt sensor_core --download {sensor_core}
          url: http://images.validation.linaro.org/functional-test-images/zephyr/arduino_101/sensor_core-arc.bin
        ble_core:
          image_arg: --alt ble_core --download {ble_core}
          url: http://images.validation.linaro.org/functional-test-images/zephyr/arduino_101/ble_core-image.bin

- boot:
    method: dfu
    timeout:
      minutes: 10


- test:
    monitors:
    - name: simple-service
      start: S I M P L E   S E R V I C E    M E A S U R E M E N T S
      end: M A I L B O X   M E A S U R E M E N T S
      pattern: '\| ?(?P<test_case_id>.*)\|(?P<measurement>.*)\|'
